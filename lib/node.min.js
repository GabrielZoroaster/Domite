let Nodes=new WeakMap,DefaultTagName="div",DefaultDocument=document;function IsString(t){return"string"==typeof t}function IsObject(t){return t&&"object"==typeof t}function IsFunction(t){return"function"==typeof t}function IsIterable(t){return IsObject(t)&&IsFunction(t[Symbol.iterator])}function IsCSSStyleDeclaration(t){return t instanceof CSSStyleDeclaration}function IsAttributeMap(t){return t instanceof AttributeMap||t instanceof NamedNodeMap}function IsDOMStringMap(t){return t instanceof IsDOMStringMap}function InvalidNode(){return new TypeError("invalid node value")}function NodeFrom(t){if(t instanceof Node)return t;throw InvalidNode()}function TagFrom(t){return NodeFrom(t).tag}function ViewRect({left:t,top:e,width:r,height:s}){return new DOMRect(t+window.scrollX,e+window.scrollY,r,s)}function*ALL(t){yield*t.ls.all,yield t}function SetOn(t,e){for(var[r,s]of Object.entries(e))t.on(r,s)}function SetOnce(t,e){for(var[r,s]of Object.entries(e))t.once(r,s)}function ClearDataSet(t){for(var e in t)delete t[e]}function CompareNodes(t,e){return t.text>e.text?1:t.text<e.text?-1:0}function*FromTags(t){for(var e of t)yield Node.from(e)}function*FilterClass(t,e){for(var r of t)r.class.contains(e)&&(yield r)}function*FilterTag(t,e){for(var r of t)r.tagName===String(e).toUpperCase()&&(yield r)}function*FilterVisible(t){for(var e of t)e.checkVisibility()&&(yield e)}function*QueryAll(t,e){for(var r of t)r.matches(e)&&(yield r)}function*LSLS(t){for(var e of t)yield*e.ls}function*LSALL(t){for(var e of t)yield*e.all}function*PrevALL(t){for(;t=t.prevNode;)yield t}function*NextALL(t){for(;t=t.nextNode;)yield t}function*ParentALL(t){for(;t=t.parent;)yield t}function ToInt(t){return Math.trunc(t)||0}function ToIndex(t,e){return(t=ToInt(t))<0?Math.max(0,t+e):e<t?e:t}function*Slice(t,e=0,r=t.length){for(e=ToIndex(e,t.length),r=ToIndex(r,t.length);e<r;e++)yield t.at(e)}function Splice(t,e){var r=[];if(0<e.length){for(var[s,i=1/0,...e]=e,s=ToIndex(s,t.length),i=ToInt(i);r.length<i&&s<t.length;){var a=t.at(s);r.push(a),a.remove()}var o=t.at(s);o?o.before(...e):t.push(...e)}return r}class Node{static from(t){return Nodes.get(t)??null}static hasNode(t){return Nodes.has(t)}static is(t){try{return t.#tag,!0}catch{return!1}}static tag(t){try{return t.#tag}catch{throw new InvalidNode}}#tag;#ls;#attrs;constructor({document:t=DefaultDocument,name:e=DefaultTagName,tag:r=t.createElement(e),class:s,style:i,attrs:a,hidden:o,on:n,once:l,text:h,html:f,ls:g}={}){this.#tag=r,this.#ls=new NodeCollection(this.tag),this.#attrs=new AttributeMap(this.tag),Nodes.set(this.tag,this),s&&(this.class=s),a&&(this.attrs=a),i&&(this.style=i),o&&(this.hidden=!0),n&&SetOn(this,n),l&&SetOnce(this,l),g?this.ls=g:h?this.text=h:f&&(this.html=f)}get tag(){return this.#tag}get tagName(){return this.tag.tagName}get document(){return this.tag.ownerDocument}get isConnected(){return this.tag.isConnected}on(t,e,r){return this.tag.addEventListener(t,e,r),this}off(t,e,r){return this.tag.removeEventListener(t,e,r),this}once(t,e,r){return this.on(t,e,{once:!0,...r}),this}emit(t){return this.dispatch(new Event(t)),this}dispatch(t){return this.tag.dispatchEvent(t),this}click(){this.tag.click()}blur(){this.tag.blur()}focus(){this.tag.focus()}scroll(...t){this.tag.scroll(...t)}scrollBy(...t){this.tag.scrollBy(...t)}scrollTo(...t){this.tag.scrollTo(...t)}scrollIntoView(...t){this.tag.scrollIntoView(...t)}animate(...t){return this.tag.animate(...t)}requestFullscreen(){return this.tag.requestFullscreen()}get hidden(){return this.tag.hidden}set hidden(t){this.tag.hidden=t}show(){this.hidden=!1}hide(){this.hidden=!0}toggleDisplay(){this.hidden=!this.hidden}checkVisibility(t){return this.tag.checkVisibility(t)}get style(){return this.tag.style}set style(t){this.css=t}get css(){return this.tag.attributeStyleMap}set css(t){if(IsString(t))this.tag.style=t;else if(IsObject(t))if(this.css.clear(),IsCSSStyleDeclaration(t))for(var e of t)this.css.set(e,t[e]);else for(var[r,s]of Object.entries(t))this.css.set(r,s)}cssAll(){return this.tag.computedStyleMap()}get class(){return this.tag.classList}set class(t){if(IsString(t))this.tag.classList=t;else if(IsIterable(t)){this.tag.classList="";for(var e of t)this.class.add(e)}}get attrs(){return this.#attrs}set attrs(t){this.attrs.setAll(t)}get dataset(){return this.tag.dataset}set dataset(t){if(IsDOMStringMap(t))for(var e in ClearDataSet(this.dataset),t)this.dataset[e]=t[e];else if(IsObject(t)){ClearDataSet(this.dataset);for(var[r,s]of Object.entries(t))this.dataset[r]=s}}get html(){return this.tag.innerHTML}set html(t){this.tag.innerHTML=t}get text(){return this.tag.innerText}set text(t){this.tag.innerText=t}get vp(){return this.tag.getBoundingClientRect()}get abs(){return ViewRect(this.vp)}get rel(){return new OffsetRect(this.tag)}get box(){return new ClientRect(this.tag)}get scr(){return new ScrollGeometry(this.tag)}get parent(){return Node.from(this.tag.parentNode)}get prevNode(){return Node.from(this.tag.previousSibling)}get nextNode(){return Node.from(this.tag.nextSibling)}set prevNode(t){this.before(t)}set nextNode(t){this.after(t)}get parentAll(){return new NodeIterator(ParentALL(this))}get prevAll(){return new NodeIterator(PrevALL(this))}get nextAll(){return new NodeIterator(NextALL(this))}get ls(){return this.#ls}get all(){return new NodeIterator(ALL(this))}set ls(t){Node.is(t)?this.ls.replace(t):this.ls.replace(...t)}isEqual(t){return this.tag.isEqualNode(Node.from(t)??t)}isSame(t){return this.tag.isSameNode(Node.from(t)??t)}contains(t){try{return this.tag.contains(t.#tag)}catch{return!1}}append(...t){this.tag.append(...t.map(Node.tag))}prepend(...t){this.tag.append(...t.map(Node.tag))}before(...t){this.tag.before(...t.map(Node.tag))}after(...t){this.tag.after(...t.map(Node.tag))}add(t){t=new Node(t);return this.append(t),t}remove(){this.tag.remove()}replace(...t){return this.tag.replaceWith(...t.map(Node.tag))}matches(t){return this.tag.matches(t)}}class NodeList{*list(){}drop(t){return new NodeIterator(this.list().drop(t))}every(t){return this.list().every(t)}filter(t){return new NodeIterator(this.list().filter(t))}find(t){return this.list().find(t)}flatMap(t){return this.list().flatMap(t)}forEach(t){return this.list().forEach(t)}map(t){return this.list().map(t)}reduce(t,...e){return this.list().reduce(t,...e)}some(t){return this.list().some(t)}take(t){return new NodeIterator(this.list().take(t))}toArray(){return this.list().toArray()}count(){let t=0;for(var e of this)t++;return t}depth(){let t=0;for(var e of this)t=Math.max(t,e.ls.depth()+1);return t}[Symbol.iterator](){return this.list()}on(t,e,r){for(var s of this)s.on(t,e,r)}off(t,e,r){for(var s of this)s.off(t,e,r)}once(t,e,r){for(var s of this)s.once(t,e,r)}emit(t){for(var e of this)e.emit(t)}show(){for(var t of this)t.show()}hide(){for(var t of this)t.hide()}toggleDisplay(){for(var t of this)t.toggleDisplay()}css(t,e){for(var r of this)r.css.set(t,e)}appendCSS(t,e){for(var r of this)r.css.append(t,e)}deleteCSS(t){for(var e of this)e.css.delete(t)}clearCSS(){for(var t of this)t.css.clear()}addClass(...t){for(var e of this)e.class.add(...t)}removeClass(...t){for(var e of this)e.class.remove(...t)}toggleClass(t,e){for(var r of this)r.class.toggle(t,e)}replaceClass(t,e){for(var r of this)r.class.replace(t,e)}clearClasses(){for(var t of this)t.class=""}*classes(){for(var t of this)yield*t.class}attr(t,e){for(var r of this)r.attrs.set(t,e)}removeAttr(t){for(var e of this)e.attrs.remove(t)}toggleAttr(t,e){for(var r of this)r.attrs.toggle(t,e)}clearAttrs(){for(var t of this)t.attrs.clear()}text(t){if(IsFunction(t))for(var e of this)e.text=t(e.text);else for(var r of this)r.text=t}html(t){if(IsFunction(text))for(var e of this)e.html=t(e.html);else for(var r of this)r.html=t}*texts(){for(var t of this)yield t.text}*htmls(){for(var t of this)yield t.html}add(t){for(var e of this)e.add(t)}remove(){for(var t of this.toArray())t.remove()}includes(t){if(Node.is(t))for(var e of this)if(e===t)return!0;return!1}contains(t){if(Node.is(t))for(var e of this)if(e.contains(t))return!0;return!1}indexOf(t){let e=0;for(var r of this){if(r===t)return e;e++}return-1}get ls(){return new NodeIterator(LSLS(this))}get all(){return new NodeIterator(LSALL(this))}queryAll(t){return new NodeIterator(QueryAll(this,t))}query(t){for(var e of this)if(e.matches(t))return e;return null}filterClass(t){return new NodeIterator(FilterClass(this,t))}filterTag(t){return new NodeIterator(FilterTag(this,t))}filterVisible(){return new NodeIterator(FilterVisible(this))}}class NodeIterator extends NodeList{static from(t){return new NodeIterator(Iterator.from(t))}static of(...t){return this.from(t)}static fromTags(t){return new NodeIterator(FromTags(t))}#list;constructor(t){super(),this.#list=t}list(){return this.#list}}class NodeCollection extends NodeList{#tag;constructor(t){super(),this.#tag=t}get tag(){return this.#tag}*list(){for(var t of this.tag.children){t=Node.from(t);t&&(yield t)}}get length(){return this.tag.childElementCount}get first(){return Node.from(this.tag.firstChild)}get last(){return Node.from(this.tag.lastChild)}set first(t){this.unshift(t)}set last(t){this.push(t)}at(t){return Node.from(this.tag.children[t])}replace(...t){this.tag.replaceChildren(...t.map(Node.tag))}clear(){this.replace()}remove(){this.clear()}slice(t,e){return new NodeIterator(Slice(this,t,e))}splice(...t){return NodeIterator.from(Splice(this,t))}shift(){var t=this.first;return t?(t.remove(),t):null}pop(){var t=this.last;return t?(t.remove(),t):null}push(...t){this.tag.append(...t.map(Node.tag))}unshift(...t){this.tag.prepend(...t.map(Node.tag))}reverse(){for(var t=this.first;this.last!==t;)t.before(this.last)}sort(t=CompareNodes){for(var e of this.toArray().sort(t))this.tag.append(Node.tag(e))}shuffle(){this.sort(()=>Math.random()-.5)}query(t){return Node.from(this.tag.querySelector(t))}queryAll(t){return NodeIterator.fromTags(this.tag.querySelectorAll(t))}filterClass(t){return NodeIterator.fromTags(this.tag.getElementsByClassName(t))}filterTag(t){return NodeIterator.fromTags(this.tag.getElementsByTagName(t))}}class AttributeMap{#tag;constructor(t){this.#tag=t}get tag(){return this.#tag}get length(){return this.tag.attributes.length}at(t){return this.tag.attributes[t]}has(t){return this.tag.hasAttribute(t)}get(t){return this.tag.getAttribute(t)}set(t,e){return this.tag.setAttribute(t,e)}remove(t){return this.tag.removeAttribute(t)}toggle(t,e){return this.tag.toggleAttribute(t,e)}clear(){for(;0<this.length;)this.remove(this.at(0).name)}*[Symbol.iterator](){yield*this.tag.attributes}setAll(t){if(this.clear(),IsAttributeMap(t))for(var e of t)this.set(e.name,e.value);else for(var[r,s]of Object.entries(t))this.set(r,s)}}class Rect{#tag;constructor(t){this.#tag=t}get tag(){return this.#tag}get x(){return this.left}get y(){return this.top}get left(){return 0}get top(){return 0}get width(){return 0}get height(){return 0}}class ScrollGeometry extends Rect{set x(t){this.tag.scrollLeft=t}set y(t){this.tag.scrollTop=t}set left(t){this.tag.scrollLeft=t}set top(t){this.tag.scrollTop=t}get x(){return this.tag.scrollLeft}get y(){return this.tag.scrollTop}get left(){return this.tag.scrollLeft}get top(){return this.tag.scrollTop}get width(){return this.tag.scrollWidth}get height(){return this.tag.scrollHeight}get hmax(){return this.width-this.tag.clientWidth}get vmax(){return this.height-this.tag.clientHeight}get tx(){return this.x/this.hmax}get ty(){return this.y/this.vmax}set tx(t){this.x=t*this.hmax}set ty(t){this.y=t*this.vmax}to(...t){this.tag.scrollTo(...t)}by(...t){this.tag.scrollBy(...t)}intoView(...t){this.tag.scrollIntoView(...t)}}class ClientRect extends Rect{get left(){return this.tag.clientLeft}get top(){return this.tag.clientTop}get width(){return this.tag.clientWidth}get height(){return this.tag.clientHeight}}class OffsetRect extends Rect{get parent(){return Node.from(this.tag.offsetParent)}get left(){return this.tag.offsetLeft}get top(){return this.tag.offsetTop}get width(){return this.tag.offsetWidth}get height(){return this.tag.offsetHeight}}export{Node,NodeIterator};
