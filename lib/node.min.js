let Nodes=new WeakMap,DefaultTagName="div",DefaultDocument=document,Observer=new MutationObserver(OnNodeMutation),NodeListeners=new WeakMap;function IsNull(t){return null===t}function IsString(t){return"string"==typeof t}function IsObject(t){return!IsNull(t)&&"object"==typeof t}function IsFunction(t){return"function"==typeof t}function IsIterable(t){return IsObject(t)&&IsFunction(t[Symbol.iterator])}function IsTag(t){return t instanceof Element}function IsCSSStyleDeclaration(t){return t instanceof CSSStyleDeclaration}function IsAttributeMap(t){return t instanceof AttributeMap||t instanceof NamedNodeMap}function IsDOMStringMap(t){return t instanceof IsDOMStringMap}function InvalidNode(){return new TypeError("Expected a Node instance")}function InvalidNodeArg(){return new TypeError("Expected a Node, Element, Object, or a string representing a tag name")}function InvalidWrapTarget(){return new TypeError("Expected a CSS selector (string), a DOM element, or a Node instance")}function InvalidWrapAllTarget(){return new TypeError("Expected a selector (string) or an iterator where each element is a Node, Element, or selector string")}function Unwrap(t){if(Node.is(t))return t.tag;if(IsTag(t))return t;if(IsObject(t))return new Node(t).tag;if(IsString(t))return new Node({name:t}).tag;throw InvalidNodeArg()}function WrapTag(t){return Node.of(t)??new Node({tag:t})}function Wrap(t){return t?WrapTag(t):null}function*WrapAll(t){for(var e of t)yield WrapTag(e)}function WrapIterator(t){return new NodeIterator(WrapAll(t))}function SearchTag(t){if(IsString(t))return document.querySelector(t);if(IsTag(t))return t;if(Node.is(t))return t.tag;throw InvalidWrapTarget()}function*SearchTagAll(t){if(IsString(t))yield*document.querySelectorAll(t);else{if(!IsIterable(t))throw InvalidWrapAllTarget();for(var e of t)yield SearchTag(e)}}function*GlobalQueryAll(t){for(var e of document.querySelectorAll(t))yield Wrap(e)}function*ALL(t){yield*t.ls.all,yield t}function*FilterClass(t,e){for(var r of t)r.class.contains(e)&&(yield r)}function*FilterTag(t,e){var r,s=String(e).toUpperCase();for(r of t)r.tagName===s&&(yield r)}function*FilterVisible(t){for(var e of t)e.checkVisibility()&&(yield e)}function*MatchAll(t,e){for(var r of t)r.matches(e)&&(yield r)}function*LSLS(t){for(var e of t)yield*e.ls}function*LSALL(t){for(var e of t)yield*e.all}function*PrevALL(t){for(;t=t.prevNode;)yield t}function*NextALL(t){for(;t=t.nextNode;)yield t}function*ParentALL(t){for(;t=t.parent;)yield t}function ViewRect({left:t,top:e,width:r,height:s}){return new DOMRect(t+window.scrollX,e+window.scrollY,r,s)}function SetOn(t,e){for(var[r,s]of Object.entries(e))t.on(r,s)}function SetOnce(t,e){for(var[r,s]of Object.entries(e))t.once(r,s)}function ClearDataSet(t){for(var e in t)delete t[e]}function CompareNodes(t,e){return t.text.localeCompare(e.text)}function ToInt(t){return Math.trunc(t)||0}function ToIndex(t,e){return(t=ToInt(t))<0?Math.max(0,t+e):e<t?e:t}function*Slice(t,e=0,r=t.length){for(e=ToIndex(e,t.length),r=ToIndex(r,t.length);e<r;e++)yield t.at(e)}function Splice(t,e){var r=[];if(0<e.length){for(var[s,a=1/0,...e]=e,s=ToIndex(s,t.length),a=ToInt(a);r.length<a&&s<t.length;){var i=t.at(s);r.push(i),i.remove()}var n=t.at(s);n?n.before(...e):t.push(...e)}return r}function OnNodeMutation(t){for(var e of t){var r=NodeListeners.get(e.target);r&&r.call(Node.of(e.target),e)}}function ObserveNode(t,e,r){NodeListeners.set(t.tag,r),Observer.observe(t.tag,e)}class Node{static hasNode(t){return Nodes.has(t)}static of(t){return Nodes.get(t)??null}static is(t){try{return t.#tag,!0}catch{return!1}}static tag(t){try{return t.#tag}catch{throw new InvalidNode}}static query(t){return Wrap(document.querySelector(t))}static queryAll(t){return new NodeIterator(GlobalQueryAll(t))}static wrap(t){t=SearchTag(t);if(t)return new this({tag:t})}static wrapAll(t){var e,r=[];for(e of SearchTagAll(t))r.push(new this({tag:e}));return NodeIterator.from(r)}static LS(t){return new NodeLS(t.tag)}static Attrs(t){return new AttributeMap(t.tag)}#tag;#ls;#attrs;constructor({document:t=DefaultDocument,name:e=DefaultTagName,tag:r=t.createElement(e),class:s,style:a,attrs:i,hidden:n,on:o,once:l,text:h,html:u,ls:c}={}){this.#tag=r,this.#ls=this.constructor.LS(this),this.#attrs=this.constructor.Attrs(this),Nodes.set(this.tag,this),s&&(this.class=s),i&&(this.attrs=i),a&&(this.style=a),n&&(this.hidden=!0),o&&SetOn(this,o),l&&SetOnce(this,l),c?this.ls=c:h?this.text=h:u&&(this.html=u)}get tag(){return this.#tag}get tagName(){return this.tag.tagName}get document(){return this.tag.ownerDocument}get isConnected(){return this.tag.isConnected}on(t,e,r){return this.tag.addEventListener(t,e,r),this}off(t,e,r){return this.tag.removeEventListener(t,e,r),this}once(t,e,r){return this.on(t,e,{once:!0,...r}),this}emit(t){return this.dispatch(new Event(t)),this}dispatch(t){return this.tag.dispatchEvent(t),this}observe(t,e){ObserveNode(this,t,e)}click(){this.tag.click()}blur(){this.tag.blur()}focus(){this.tag.focus()}scroll(...t){this.tag.scroll(...t)}scrollBy(...t){this.tag.scrollBy(...t)}scrollTo(...t){this.tag.scrollTo(...t)}scrollIntoView(...t){this.tag.scrollIntoView(...t)}animate(...t){return this.tag.animate(...t)}requestFullscreen(){return this.tag.requestFullscreen()}get hidden(){return this.tag.hidden}set hidden(t){this.tag.hidden=t}show(){this.hidden=!1}hide(){this.hidden=!0}toggleDisplay(){return this.hidden?(this.show(),!0):(this.hide(),!1)}checkVisibility(t){return this.tag.checkVisibility(t)}get style(){return this.tag.style}set style(t){this.css=t}get css(){return this.tag.attributeStyleMap}set css(t){if(IsString(t))this.tag.style=t;else if(IsObject(t))if(this.css.clear(),IsCSSStyleDeclaration(t))for(var e of t)this.css.set(e,t[e]);else for(var[r,s]of Object.entries(t))this.css.set(r,s)}cssAll(){return this.tag.computedStyleMap()}get class(){return this.tag.classList}set class(t){if(IsString(t))this.tag.classList=t;else if(IsIterable(t)){this.tag.classList="";for(var e of t)this.class.add(e)}}get attrs(){return this.#attrs}set attrs(t){this.attrs.replace(t)}get dataset(){return this.tag.dataset}set dataset(t){if(IsDOMStringMap(t))for(var e in ClearDataSet(this.dataset),t)this.dataset[e]=t[e];else if(IsObject(t)){ClearDataSet(this.dataset);for(var[r,s]of Object.entries(t))this.dataset[r]=s}}get html(){return this.tag.innerHTML}set html(t){this.tag.innerHTML=t}get text(){return this.tag.innerText}set text(t){this.tag.innerText=t}get vp(){return this.tag.getBoundingClientRect()}get abs(){return ViewRect(this.vp)}get rel(){return new OffsetRect(this.tag)}get box(){return new ClientRect(this.tag)}get scr(){return new ScrollGeometry(this.tag)}get parent(){return Wrap(this.tag.parentElement)}get prevNode(){return Wrap(this.tag.previousElementSibling)}get nextNode(){return Wrap(this.tag.nextElementSibling)}set parent(t){IsNull(t)?this.remove():Unwrap(t).append(this.tag)}set prevNode(t){this.before(t)}set nextNode(t){this.after(t)}get parentAll(){return new NodeIterator(ParentALL(this))}get prevAll(){return new NodeIterator(PrevALL(this))}get nextAll(){return new NodeIterator(NextALL(this))}get ls(){return this.#ls}get all(){return new NodeIterator(ALL(this))}set ls(t){IsIterable(t)?this.ls.replace(...t):this.ls.replace(t)}isEqual(t){return this.tag.isEqualNode(Node.of(t)??t)}isSame(t){return this.tag.isSameNode(Node.of(t)??t)}contains(t){try{return this.tag.contains(t.#tag)}catch{return this.tag.contains(t)}}append(...t){this.tag.append(...t.map(Unwrap))}prepend(...t){this.tag.append(...t.map(Unwrap))}before(...t){this.tag.before(...t.map(Unwrap))}after(...t){this.tag.after(...t.map(Unwrap))}add(t){t=new Node(t);return this.append(t),t}remove(){this.tag.remove()}replace(...t){return this.tag.replaceWith(...t.map(Unwrap))}matches(t){return this.tag.matches(t)}closest(t){return Wrap(this.tag.closest(t))}}class NodeGenerator{*list(){}drop(t){return new NodeIterator(this.list().drop(t))}every(t){return this.list().every(t)}filter(t){return new NodeIterator(this.list().filter(t))}find(t){return this.list().find(t)}flatMap(t){return this.list().flatMap(t)}forEach(t){return this.list().forEach(t)}map(t){return this.list().map(t)}reduce(t,...e){return this.list().reduce(t,...e)}some(t){return this.list().some(t)}take(t){return new NodeIterator(this.list().take(t))}toArray(){return this.list().toArray()}count(){let t=0;for(var e of this)t++;return t}depth(){let t=0;for(var e of this)t=Math.max(t,e.ls.depth()+1);return t}[Symbol.iterator](){return this.list()}on(t,e,r){for(var s of this)s.on(t,e,r)}off(t,e,r){for(var s of this)s.off(t,e,r)}once(t,e,r){for(var s of this)s.once(t,e,r)}emit(t){for(var e of this)e.emit(t)}show(){for(var t of this)t.show()}hide(){for(var t of this)t.hide()}toggleDisplay(){for(var t of this)t.toggleDisplay()}css(t,e){for(var r of this)r.css.set(t,e)}appendCSS(t,e){for(var r of this)r.css.append(t,e)}deleteCSS(t){for(var e of this)e.css.delete(t)}clearCSS(){for(var t of this)t.css.clear()}addClass(...t){for(var e of this)e.class.add(...t)}removeClass(...t){for(var e of this)e.class.remove(...t)}toggleClass(t,e){for(var r of this)r.class.toggle(t,e)}replaceClass(t,e){for(var r of this)r.class.replace(t,e)}clearClasses(){for(var t of this)t.class=""}*classes(){for(var t of this)yield*t.class}attr(t,e){for(var r of this)r.attrs.set(t,e)}removeAttr(t){for(var e of this)e.attrs.remove(t)}toggleAttr(t,e){for(var r of this)r.attrs.toggle(t,e)}clearAttrs(){for(var t of this)t.attrs.clear()}text(t){if(IsFunction(t))for(var e of this)e.text=t(e.text);else for(var r of this)r.text=t}html(t){if(IsFunction(text))for(var e of this)e.html=t(e.html);else for(var r of this)r.html=t}*texts(){for(var t of this)yield t.text}*htmls(){for(var t of this)yield t.html}add(t){for(var e of this)e.add(t)}remove(){for(var t of this.toArray())t.remove()}includes(t){if(Node.is(t))for(var e of this)if(e===t)return!0;return!1}contains(t){if(Node.is(t))for(var e of this)if(e.contains(t))return!0;return!1}indexOf(t){let e=0;for(var r of this){if(r===t)return e;e++}return-1}get ls(){return new NodeIterator(LSLS(this))}get all(){return new NodeIterator(LSALL(this))}matchAll(t){return new NodeIterator(MatchAll(this,t))}match(t){for(var e of this)if(e.matches(t))return e;return null}filterClass(t){return new NodeIterator(FilterClass(this,t))}filterTag(t){return new NodeIterator(FilterTag(this,t))}filterVisible(){return new NodeIterator(FilterVisible(this))}}class NodeIterator extends NodeGenerator{static from(t){return new NodeIterator(Iterator.from(t))}static of(...t){return this.from(t)}static wrap(t){return WrapIterator(t)}#list;constructor(t){super(),this.#list=t}list(){return this.#list}}class NodeLS extends NodeGenerator{#tag;constructor(t){super(),this.#tag=t}get tag(){return this.#tag}list(){return WrapAll(this.tag.children)}get length(){return this.tag.childElementCount}get first(){return Wrap(this.tag.firstElementChild)}get last(){return Wrap(this.tag.lastElementChild)}set first(t){this.unshift(t)}set last(t){this.push(t)}at(t){return Wrap(this.tag.children[t])}includes(t){try{return Node.tag(t).parentNode===this.tag}catch{return!1}}replace(...t){this.tag.replaceChildren(...t.map(Unwrap))}clear(){this.replace()}remove(){this.clear()}slice(t,e){return new NodeIterator(Slice(this,t,e))}splice(...t){return NodeIterator.from(Splice(this,t))}shift(){var t=this.first;return t?(t.remove(),t):null}pop(){var t=this.last;return t?(t.remove(),t):null}push(...t){return this.tag.append(...t.map(Unwrap)),t.length}unshift(...t){return this.tag.prepend(...t.map(Unwrap)),t.length}sort(t=CompareNodes){return this.push(...this.toArray().sort(t)),this}reverse(){for(var t=this.first;this.last!==t;)t.before(this.last);return this}shuffle(){return this.sort(()=>Math.random()-.5),this}query(t){return Wrap(this.tag.querySelector(t))}queryAll(t){return WrapIterator(this.tag.querySelectorAll(t))}filterClass(t){return WrapIterator(this.tag.getElementsByClassName(t))}filterTag(t){return WrapIterator(this.tag.getElementsByTagName(t))}}class AttributeMap{#tag;constructor(t){this.#tag=t}get tag(){return this.#tag}get length(){return this.tag.attributes.length}at(t){return this.tag.attributes[t]}has(t){return this.tag.hasAttribute(t)}get(t){return this.tag.getAttribute(t)}set(t,e){return this.tag.setAttribute(t,e)}remove(t){return this.tag.removeAttribute(t)}toggle(t,e){return this.tag.toggleAttribute(t,e)}clear(){for(;0<this.length;)this.remove(this.at(0).name)}*[Symbol.iterator](){yield*this.tag.attributes}replace(t){if(this.clear(),IsAttributeMap(t))for(var e of t)this.set(e.name,e.value);else for(var[r,s]of Object.entries(t))this.set(r,s)}}class Rect{#tag;constructor(t){this.#tag=t}get tag(){return this.#tag}get x(){return this.left}get y(){return this.top}get left(){return 0}get top(){return 0}get width(){return 0}get height(){return 0}}class ScrollGeometry extends Rect{set x(t){this.tag.scrollLeft=t}set y(t){this.tag.scrollTop=t}set left(t){this.tag.scrollLeft=t}set top(t){this.tag.scrollTop=t}get x(){return this.tag.scrollLeft}get y(){return this.tag.scrollTop}get left(){return this.tag.scrollLeft}get top(){return this.tag.scrollTop}get width(){return this.tag.scrollWidth}get height(){return this.tag.scrollHeight}get hmax(){return this.width-this.tag.clientWidth}get vmax(){return this.height-this.tag.clientHeight}get tx(){return this.x/this.hmax}get ty(){return this.y/this.vmax}set tx(t){this.x=t*this.hmax}set ty(t){this.y=t*this.vmax}to(...t){this.tag.scrollTo(...t)}by(...t){this.tag.scrollBy(...t)}intoView(...t){this.tag.scrollIntoView(...t)}}class ClientRect extends Rect{get left(){return this.tag.clientLeft}get top(){return this.tag.clientTop}get width(){return this.tag.clientWidth}get height(){return this.tag.clientHeight}}class OffsetRect extends Rect{get parent(){return Wrap(this.tag.offsetParent)}get left(){return this.tag.offsetLeft}get top(){return this.tag.offsetTop}get width(){return this.tag.offsetWidth}get height(){return this.tag.offsetHeight}}export{Node,NodeLS,NodeIterator};
